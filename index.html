<script>
const submitButton = document.getElementById('submitBtn');
const askInput = document.getElementById('askInput');
const kaiReply = document.getElementById('kaiReply');

submitButton.addEventListener('click', async () => {
  const userQuestion = askInput.value.trim();
  if (!userQuestion) {
    return;
  }

  // Create a container for the new Q&A
  const qaContainer = document.createElement('div');
  qaContainer.className = 'mb-6';

  // Add user question
  const userText = document.createElement('p');
  userText.className = 'text-right text-blue-700 font-semibold mb-2';
  userText.textContent = `You: ${userQuestion}`;
  qaContainer.appendChild(userText);

  // Add placeholder for Kai's reply
  const kaiText = document.createElement('p');
  kaiText.className = 'text-left text-green-600 font-semibold';
  kaiText.textContent = "Kai is thinking...";
  qaContainer.appendChild(kaiText);

  // Add the new Q&A to the chat box
  kaiReply.appendChild(qaContainer);

  // Scroll to bottom
  kaiReply.scrollTop = kaiReply.scrollHeight;

  // Clear input box
  askInput.value = "";

  try {
    const response = await fetch('https://askkai-backend-clean.onrender.com/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt: userQuestion })
    });

    const data = await response.json();
    const finalText = data.reply || "Hmm, couldn't find an answer!";

    // Animate Kai's reply with typewriter effect
    kaiText.textContent = "";
    let i = 0;
    const speed = 40; // typing speed (ms per character)

    function typeWriter() {
      if (i < finalText.length) {
        kaiText.textContent += finalText.charAt(i);
        i++;
        setTimeout(typeWriter, speed);
      }
    }

    typeWriter();

  } catch (error) {
    console.error(error);
    kaiText.textContent = "Error reaching Kai. Try again later.";
  }
});
</script>
