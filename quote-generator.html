<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quote Generator – Ask Kai</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .kaymar-green { color: #7AC142; }
    html, body { height: 100%; margin: 0; padding: 0; display: flex; flex-direction: column; }
    #kaiReply { max-height: 60vh; overflow-y: auto; }
    .blinking-cursor {
      display: inline-block;
      width: 10px;
      height: 1em;
      background-color: #7AC142;
      margin-left: 4px;
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body class="bg-white text-gray-800">
  <header class="bg-black text-white p-4 flex justify-between items-center">
    <img src="https://i.imgur.com/zcqscCO_d.png" alt="Kaymar Logo" class="h-10">
    <h1 class="text-lg font-bold kaymar-green">Quote Generator – Ask Kai</h1>
  </header>

  <main class="flex flex-col items-center flex-1 p-4">
    <div id="kaiReply" class="w-full max-w-2xl mb-4 p-4 bg-white border rounded shadow space-y-4"></div>

    <div class="w-full max-w-2xl p-4 bg-white shadow-md border-t flex items-center space-x-2">
      <input id="askInput" type="text" placeholder="Describe your project..." class="flex-1 border p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" />
      <button id="submitBtn" class="bg-black text-white px-6 py-2 rounded-lg hover:bg-gray-900 transition">Submit</button>
    </div>

    <div id="quoteSummary" class="max-w-2xl w-full bg-gray-50 border mt-6 p-4 rounded shadow hidden">
      <h2 class="text-xl font-bold mb-2 text-green-700">Materials Summary (Rough Guide)</h2>
      <pre id="quoteContent" class="whitespace-pre-wrap text-sm text-gray-700"></pre>
      <p class="text-xs text-gray-500 mt-2">Note: This is an estimated material list based on limited info. Double check with your local supplier or builder. Prices not included.</p>
    </div>
  </main>

  <footer class="text-center text-gray-500 text-sm p-4">
    &copy; 2025 Kaymar Construction | Powered by Ask Kai
  </footer>

  <script>
    const submitBtn = document.getElementById("submitBtn");
    const askInput = document.getElementById("askInput");
    const kaiReply = document.getElementById("kaiReply");
    const quoteSummary = document.getElementById("quoteSummary");
    const quoteContent = document.getElementById("quoteContent");

    const quoteMessages = [{
      role: "system",
      content: `You are Kai Marlow — an experienced Aussie carpenter and quote assistant.
Always ask for:
- Location (to check building code / footing depth)
- Board sizes (e.g. 90mm or 140mm, 5.4m composite etc)
- Ground clearance / height
- Subfloor materials (timber type, stump spacing)
- Fixings, hardware, brand preferences

Reply in short, clear chunks. Use metric and Australian codes. For any quote, return a material list only when you have enough detail.

ALWAYS provide a short disclaimer about checking local code and verifying quote before ordering.`
    }];

    submitBtn.addEventListener("click", async () => {
      const userInput = askInput.value.trim();
      if (!userInput) return;

      quoteMessages.push({ role: "user", content: userInput });

      const qa = document.createElement("div");
      qa.className = "mb-6";
      const userBubble = document.createElement("p");
      userBubble.className = "text-right text-blue-700 font-semibold mb-2";
      userBubble.textContent = `You: ${userInput}`;
      qa.appendChild(userBubble);

      const kaiBubble = document.createElement("p");
      kaiBubble.className = "text-left text-green-700 font-semibold";
      kaiBubble.textContent = "Kai is working out the details...";
      qa.appendChild(kaiBubble);

      kaiReply.appendChild(qa);
      kaiReply.scrollTop = kaiReply.scrollHeight;
      askInput.value = "";

      try {
        const response = await fetch("https://askkai-backend-clean.onrender.com/quote", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: quoteMessages })
        });

        const data = await response.json();
        const reply = data.reply || "Hmm, couldn't generate a quote.";

        kaiBubble.textContent = reply;
        quoteMessages.push({ role: "assistant", content: reply });

        // Display and update quote summary
        quoteSummary.classList.remove("hidden");
        quoteContent.textContent = reply;

      } catch (err) {
        console.error(err);
        kaiBubble.textContent = "Something went wrong. Try again later.";
      }
    });
  </script>
</body>
</html>
