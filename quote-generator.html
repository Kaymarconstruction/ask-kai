<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quote Generator – Ask Kai</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .kaymar-green { color: #7AC142; }
    html, body { margin: 0; padding: 0; }
    .blinking-cursor {
      display: inline-block;
      width: 10px;
      height: 1em;
      background-color: #7AC142;
      margin-left: 4px;
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body class="bg-white text-gray-800">

  <!-- Header -->
  <header class="bg-black text-white shadow p-4 flex items-center justify-between">
    <img src="https://i.imgur.com/zcqscCO.png" alt="Kaymar Logo" class="h-10" />
    <h1 class="text-xl font-bold">Quote Generator</h1>
    <a href="index.html" class="text-sm underline hover:text-gray-300">Back to Ask Kai</a>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto p-6">
    <!-- Kai Profile -->
    <div class="flex flex-col items-center text-center">
      <img src="https://i.imgur.com/uYWtV9r.png" alt="Kai" class="w-32 h-48 object-cover rounded-xl shadow mb-4">
      <h2 class="text-2xl font-bold kaymar-green mb-2">Ask Kai a Quote</h2>
      <p class="text-gray-600 mb-6">
        Describe your building project in detail and Kai will build a materials list and quote below. Each update refines the results.
      </p>
    </div>

    <!-- Chat Area -->
    <div id="chatArea" class="bg-white border rounded-lg p-4 mb-4 space-y-4 max-h-[400px] overflow-y-auto"></div>

    <!-- Input -->
    <div class="flex items-center space-x-2 mb-4">
      <input id="quoteInput" type="text" placeholder="Describe your job..." class="flex-1 border p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" />
      <button onclick="sendQuotePrompt()" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-900 transition">Submit</button>
    </div>

    <!-- Generated Quote Section -->
    <div id="quoteBox" class="bg-gray-100 border border-green-500 rounded-lg p-4 mt-6 hidden">
      <h3 class="text-lg font-semibold kaymar-green mb-2">Generated Quote:</h3>
      <pre id="quoteContent" class="whitespace-pre-wrap text-gray-800 text-sm"></pre>
      <p class="text-xs text-gray-500 mt-4">
        Note: This estimate is for materials only. Always confirm quantities and pricing with your local supplier. Copy and paste into your accounting software (Xero, MYOB, QuickBooks, etc).
      </p>
    </div>
  </main>

  <!-- Scripts -->
  <script>
    const chatArea = document.getElementById("chatArea");
    const input = document.getElementById("quoteInput");
    const quoteBox = document.getElementById("quoteBox");
    const quoteContent = document.getElementById("quoteContent");

    const quoteMessages = [{
      role: "system",
      content: `You are Kai Marlow – a qualified Aussie carpenter with 20+ years' experience.
You now generate quotes and takeoffs based on the user's building job description.

Important Rules:
- Always ask for the user's **location**, code requirements and dimensions first.
- Use **metric units** (mm, m).
- Always ask follow-up questions before giving a quote.
- For framing, use Australian standard timber sizes (MGP10, MGP12, H3 etc).
- Composite decking = 5.4m length. Cement sheet = 450/600/1200 x 2400.
- Round up timber to nearest 600mm length (1.8, 2.4, 3.0, ..., 6.0m).
- Only quote **materials**. Mention that pricing is an estimate.

Keep responses clear and between 20–80 words unless building the full quote.`
    }];

    async function sendQuotePrompt() {
      const userText = input.value.trim();
      if (!userText) return;

      const userMsg = document.createElement("p");
      userMsg.className = "text-right text-blue-700 font-semibold";
      userMsg.textContent = "You: " + userText;
      chatArea.appendChild(userMsg);

      const kaiMsg = document.createElement("p");
      kaiMsg.className = "text-left text-green-600 font-semibold";
      kaiMsg.textContent = "Kai is thinking...";
      chatArea.appendChild(kaiMsg);

      chatArea.scrollTop = chatArea.scrollHeight;
      input.value = "";

      quoteMessages.push({ role: "user", content: userText });

      try {
        const res = await fetch("https://askkai-backend-clean.onrender.com/quote", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: quoteMessages })
        });

        const data = await res.json();
        const reply = data.reply || "Sorry, something went wrong.";

        kaiMsg.textContent = reply;
        quoteContent.textContent = reply;
        quoteBox.classList.remove("hidden");

        quoteMessages.push({ role: "assistant", content: reply });
      } catch (err) {
        console.error(err);
        kaiMsg.textContent = "Something went wrong. Try again later.";
      }
    }
  </script>
</body>
</html>
