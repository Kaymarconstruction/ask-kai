<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quote Generator – Ask Kai</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .kaymar-green { color: #7AC142; }
    .blinking-cursor {
      display: inline-block;
      width: 10px;
      height: 1em;
      background-color: #7AC142;
      margin-left: 4px;
      animation: blink 1s steps(2, start) infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body class="bg-white text-gray-800">

  <!-- Header -->
  <header class="bg-black text-white p-4 flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <img src="https://i.imgur.com/zcqscCO_d.png?maxwidth=520&shape=thumb&fidelity=high" alt="Kaymar Logo" class="h-10" />
      <h1 class="text-xl font-bold">Quote Generator</h1>
    </div>
    <a href="index.html" class="text-sm hover:underline">Back to Chat</a>
  </header>

  <!-- Main -->
  <main class="max-w-4xl mx-auto p-6">
    <!-- Kai Profile Section -->
    <div class="flex items-center space-x-6 mb-8">
      <img src="https://i.imgur.com/uYWtV9r_d.png?maxwidth=520&shape=thumb&fidelity=high" alt="Kai Profile" class="w-28 h-40 object-cover rounded-2xl shadow" />
      <div>
        <h2 class="text-2xl font-bold kaymar-green">Quote with Kai</h2>
        <p class="text-gray-700">Describe your project and Kai will help you break it down — materials, labour, and accurate specs based on your region.</p>
      </div>
    </div>

    <!-- Chat and Input -->
    <div id="quoteOutput" class="space-y-6 mb-8"></div>

    <div class="flex items-center space-x-2">
      <input id="quoteInput" type="text" placeholder="Describe your job..." class="flex-1 border p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-black" />
      <button id="generateBtn" class="bg-black text-white px-6 py-2 rounded-lg hover:bg-gray-900 transition">Generate</button>
    </div>

    <!-- Quote Summary Area -->
    <div class="mt-10 p-6 border rounded-lg shadow bg-gray-50">
      <h3 class="text-lg font-semibold mb-2">Quote Summary</h3>
      <div id="quoteSummary" class="text-sm text-gray-800 space-y-2">
        <p class="italic text-gray-500">Generated quote items will appear here...</p>
      </div>
    </div>
  </main>

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const quoteInput = document.getElementById('quoteInput');
    const quoteOutput = document.getElementById('quoteOutput');
    const quoteSummary = document.getElementById('quoteSummary');

    const messages = [{
      role: "system",
      content: `You are Kai Marlow — a quoting assistant for all types of trade jobs. Ask the user clarifying questions about size, location, codes, materials, and calculate quantities. Responses must be clear, short (20–80 words), and practical. Round timber to nearest length (1.8m to 6m, in 0.6m increments). Suggest itemised materials with quantities and update a quote breakdown at the bottom.`
    }];

    generateBtn.addEventListener('click', async () => {
      const userText = quoteInput.value.trim();
      if (!userText) return;

      messages.push({ role: "user", content: userText });

      const block = document.createElement('div');
      block.innerHTML = `
        <p class="text-right text-blue-700 font-semibold">You: ${userText}</p>
        <p class="text-left text-green-600 font-semibold">Kai is thinking<span class="blinking-cursor"></span></p>
      `;
      quoteOutput.appendChild(block);
      quoteOutput.scrollTop = quoteOutput.scrollHeight;
      quoteInput.value = "";

      try {
        const response = await fetch('https://askkai-backend-clean.onrender.com/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ messages })
        });

        const data = await response.json();
        const reply = data.reply || "Hmm, couldn't build a quote right now.";

        block.lastElementChild.textContent = reply;
        messages.push({ role: "assistant", content: reply });

        // Update summary
        const item = document.createElement('p');
        item.textContent = reply;
        quoteSummary.appendChild(item);

      } catch (err) {
        console.error(err);
        block.lastElementChild.textContent = "Kai had trouble thinking — try again later.";
      }
    });
  </script>
</body>
</html>
